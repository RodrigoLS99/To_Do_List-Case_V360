<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  
  <div class="mb-6">
    <%= link_to todo_lists_path, class: "text-gray-500 hover:text-blue-600 flex items-center gap-1 text-sm font-medium transition" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
      Voltar para Minhas Listas
    <% end %>
  </div>

  <div class="bg-white rounded-t-xl shadow-sm border border-gray-200 p-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    
    <div>
      <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-2">
        ğŸ“ <%= @todo_list.title %>
      </h1>
      <p class="text-sm text-gray-500 mt-1 ml-1">
        Criada em <%= @todo_list.created_at.strftime("%d/%m/%Y") %>
      </p>
    </div>

    <div class="flex items-center gap-2">
      <%= link_to edit_todo_list_path(@todo_list), class: "px-4 py-2 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition text-sm flex items-center gap-2" do %>
        <span>âœï¸</span> Editar
      <% end %>

      <%= button_to @todo_list, method: :delete, form: { data: { turbo_confirm: "Tem certeza que deseja apagar esta lista e todas as tarefas dela?" } }, class: "px-4 py-2 bg-red-50 border border-red-100 text-red-600 font-medium rounded-lg hover:bg-red-100 transition text-sm flex items-center gap-2 cursor-pointer" do %>
        <span>ğŸ—‘ï¸</span> Apagar
      <% end %>
    </div>
  </div>

  <div class="bg-gray-50 border-x border-b border-gray-200 rounded-b-xl p-6 min-h-[300px]">
    
    <%= turbo_frame_tag "tasks", 
         class: "space-y-4 mb-8 block", 
         data: { controller: "sortable", url: "/todo_lists/#{@todo_list.id}/tasks/:id/move" } do %>

      <% @todo_list.tasks.each do |task| %>
        <% if task.persisted? %>
          <div data-id="<%= task.id %>" class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 group transition hover:border-blue-300 <%= 'opacity-60 bg-gray-50' if task.completed_at? %>">
            
            <div class="flex items-start justify-between">
              
              <div class="flex items-start gap-3 w-full">
                
                <div class="cursor-move text-gray-300 hover:text-gray-500 mt-1.5 px-1 cursor-grab active:cursor-grabbing" title="Arrastar para reordenar">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
                </div>
                
                <% if task.completed_at? %>
                  <%= button_to complete_todo_list_task_path(@todo_list, task), method: :patch, class: "mt-1 w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center border border-green-200 hover:bg-green-200 cursor-pointer transition flex-shrink-0", title: "Reabrir tarefa" do %>
                    âœ“
                  <% end %>
                <% else %>
                  <%= button_to complete_todo_list_task_path(@todo_list, task), method: :patch, class: "mt-1 w-6 h-6 rounded-full border-2 border-gray-300 hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition flex-shrink-0", title: "Marcar como concluÃ­do" do %>
                  <% end %>
                <% end %>

                <div class="flex-1">
                  <p class="text-gray-800 font-medium <%= 'line-through text-gray-400 decoration-gray-400' if task.completed_at? %>">
                    <%= task.content %>
                  </p>

                  <div class="mt-1 flex flex-wrap gap-3 text-xs text-gray-500">
                    <% if task.due_date.present? %>
                      <span class="flex items-center gap-1 <%= 'text-red-500 font-semibold' if task.due_date < Time.current && !task.completed_at? %>">
                        ğŸ“… <%= task.due_date.strftime("%d/%m/%Y") %>
                        <%= "(Atrasado)" if task.due_date < Time.current && !task.completed_at? %>
                      </span>
                    <% end %>

                    <% if task.comment.present? %>
                      <span class="flex items-center gap-1" title="<%= task.comment %>">
                        ğŸ’¬ <%= task.comment %>
                      </span>
                    <% end %>
                  </div>
                </div>
              </div>

              <%= button_to "Ã—", todo_list_task_path(@todo_list, task), method: :delete, class: "text-gray-300 hover:text-red-600 font-bold text-2xl px-2 cursor-pointer opacity-0 group-hover:opacity-100 transition leading-none -mt-1", title: "Excluir tarefa" %>
            </div>

          </div>
        <% end %>
      <% end %>

      <% if @todo_list.tasks.none?(&:persisted?) %>
        <p class="text-center text-gray-400 py-4 italic text-sm">Nenhuma tarefa criada ainda.</p>
      <% end %>

    <% end %> <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm mt-8">
      <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-3">Nova Tarefa</h3>
      
      <%= form_with(model: [@todo_list, @todo_list.tasks.build], class: "flex flex-col gap-3", data: { turbo_frame: "tasks" }) do |f| %>
        
        <%= f.text_field :content, placeholder: "O que precisa ser feito?", class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2", required: true, autocomplete: "off" %>
        
        <div class="flex flex-col sm:flex-row gap-3">
          <div class="w-full sm:w-1/3">
            <%= f.date_field :due_date, class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 text-sm text-gray-500" %>
          </div>
          
          <div class="w-full sm:w-2/3">
            <%= f.text_field :comment, placeholder: "Obs: (Opcional)", class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 text-sm" %>
          </div>
        </div>

        <%= f.submit "Adicionar Tarefa", class: "w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-sm transition cursor-pointer text-sm mt-1" %>
      <% end %>
    </div>

  </div>

</div>